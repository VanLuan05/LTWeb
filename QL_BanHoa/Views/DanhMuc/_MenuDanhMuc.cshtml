@model IEnumerable<QL_BanHoa.DanhMuc>
<link href="~/Content/css/menu_stype.css" rel="stylesheet" />
<div class="horizontal-menu-container">
    <ul class="horizontal-menu">
        @foreach (var danhMuc in Model.Where(d => d.TRANGTHAI == "Hiển thị").OrderBy(d => d.TENDM))
        {
            <li class="menu-item @(danhMuc.DanhMuc1.Any() ? "has-dropdown" : "")">
                <a href="@Url.Action("Index", "DanhMuc", new { id = danhMuc.MADM })" class="menu-link">
                    @danhMuc.TENDM
                    @if (danhMuc.DanhMuc1.Any())
                    {
                        <span class="dropdown-arrow">▼</span>
                    }
                </a>

                @if (danhMuc.DanhMuc1.Any())
                {
                    <div class="dropdown-submenu">
                        @foreach (var dmCon in danhMuc.DanhMuc1.Where(d => d.TRANGTHAI == "Hiển thị").OrderBy(d => d.TENDM))
                        {
                            // 1. Tính toán số lượng trước khi vẽ thẻ a
                            var count = dmCon.SanPhams.Count(sp => sp.TRANGTHAI == "Còn hàng");

                            <a href="@Url.Action("Index", "DanhMuc", new { id = dmCon.MADM })" class="submenu-item" style="display: flex; justify-content: space-between; align-items: center;">
                                <span>@dmCon.TENDM</span>

                                @if (count > 0)
                                {
                                    <span class="product-count" style="margin-left: 5px;">(@count)</span>
                                }
                            </a>
                        }
                    </div>
                }
            </li>
        }
    </ul>
</div>

